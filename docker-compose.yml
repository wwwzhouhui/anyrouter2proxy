version: '3.8'

# AnyRouter2Proxy - 透传模式
# 客户端必须提供有效的 anyrouter.top API Key
# 支持多 key 负载均衡（逗号分隔）

services:
  # Anthropic 协议代理服务
  anthropic-proxy:
    image: wwwzhouhui569/anyrouter2proxy:latest
    container_name: anyrouter-anthropic-proxy
    restart: unless-stopped
    environment:
      - RUN_MODE=anthropic
      - ANYROUTER_BASE_URL=${ANYROUTER_BASE_URL:-https://anyrouter.top}
      - PORT=${PORT:-9998}
      - HOST=${HOST:-0.0.0.0}
      - HTTP_TIMEOUT=${HTTP_TIMEOUT:-120}
      - DEFAULT_MAX_TOKENS=${DEFAULT_MAX_TOKENS:-8192}
    ports:
      - "9998:9998"
    volumes:
      - ./logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9998/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    networks:
      - anyrouter-proxy

  # OpenAI 协议代理服务
  openai-proxy:
    image: wwwzhouhui569/anyrouter2proxy:latest
    container_name: anyrouter-openai-proxy
    restart: unless-stopped
    environment:
      - RUN_MODE=openai
      - ANYROUTER_BASE_URL=${ANYROUTER_BASE_URL:-https://anyrouter.top}
      - OPENAI_PROXY_PORT=${OPENAI_PROXY_PORT:-9999}
      - HOST=${HOST:-0.0.0.0}
      - HTTP_TIMEOUT=${HTTP_TIMEOUT:-120}
      - DEFAULT_MAX_TOKENS=${DEFAULT_MAX_TOKENS:-8192}
      - FORCE_NON_STREAM=${FORCE_NON_STREAM:-false}
      - DEFAULT_SYSTEM_PROMPT=${DEFAULT_SYSTEM_PROMPT:-You are Claude, a helpful AI assistant.}
    ports:
      - "9999:9999"
    volumes:
      - ./logs:/app/logs
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:9999/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 5s
    networks:
      - anyrouter-proxy

networks:
  anyrouter-proxy:
    driver: bridge

volumes:
  logs:
    driver: local
